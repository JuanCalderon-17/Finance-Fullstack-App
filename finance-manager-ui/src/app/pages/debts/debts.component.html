<div class="bg-dark text-white py-4 mb-4 shadow">
  <div class="container d-flex justify-content-between align-items-center">
    <div>
      <h2 class="fw-bold mb-0">üí≥ Mis Deudas</h2>
      <p class="text-white-50 mb-0 small">Control total: Plazos, Intereses y Avance.</p>
    </div>
    <a routerLink="/dashboard" class="btn btn-outline-light btn-sm">
      <i class="bi bi-arrow-left"></i> Volver
    </a>
  </div>
</div>

<div class="container">
  <div class="row">

    <div class="col-lg-4 mb-4">
      <div class="card shadow-sm border-0 sticky-top" style="top: 20px; z-index: 1;">
        <div class="card-header fw-bold text-white" 
             [ngClass]="isEditing ? 'bg-warning' : 'bg-primary'">
          {{ isEditing ? '‚úèÔ∏è Editando Deuda' : '‚ûï Nueva Deuda' }}
        </div>
        <div class="card-body">
          <form (ngSubmit)="saveDebt()">
            
            <div class="mb-3">
              <label class="form-label small fw-bold">Nombre</label>
              <input type="text" class="form-control" [(ngModel)]="currentDebt.name" name="name" required>
            </div>

            <div class="mb-3">
              <label class="form-label small fw-bold">Monto Total Prestado ($)</label>
              <input type="number" class="form-control" [(ngModel)]="currentDebt.balance" name="balance" required>
            </div>

            <div class="row">
              <div class="col-6 mb-3">
                <label class="form-label small fw-bold">Inter√©s Anual (%)</label>
                <input type="number" class="form-control" [(ngModel)]="currentDebt.interestRate" name="rate">
              </div>
              <div class="col-6 mb-3">
                <label class="form-label small fw-bold">Plazo (Meses)</label>
                <input type="number" class="form-control" [(ngModel)]="currentDebt.installments" name="installments">
              </div>
            </div>

            <div class="d-grid gap-2">
              <button type="submit" class="btn" 
                      [ngClass]="isEditing ? 'btn-warning text-dark' : 'btn-primary'"
                      [disabled]="!currentDebt.name || currentDebt.balance <= 0">
                {{ isEditing ? 'Guardar Cambios' : 'Crear Deuda' }}
              </button>
              
              <button *ngIf="isEditing" type="button" class="btn btn-outline-secondary" (click)="resetForm()">
                Cancelar Edici√≥n
              </button>
            </div>

          </form>
        </div>
      </div>
    </div>

    <div class="col-lg-8">
      
      <div *ngIf="debts.length === 0" class="alert alert-info text-center">
        No hay deudas registradas.
      </div>

      <div class="card shadow-sm border-0 mb-3" *ngFor="let d of debts">
        <div class="card-body">
          
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h4 class="fw-bold mb-0 text-dark">{{ d.name }}</h4>
              <div class="mt-1">
                <span class="badge bg-light text-dark border me-1">
                  {{ d.interestRate }}% Inter√©s
                </span>
                <span class="badge bg-light text-dark border">
                  {{ d.installments }} Cuotas
                </span>
              </div>
            </div>
            
            <div>
              <button class="btn btn-outline-warning btn-sm me-2" (click)="startEdit(d)">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn btn-outline-danger btn-sm" (click)="deleteDebt(d.id)">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>

          <div class="row g-3">
            <div class="col-md-5">
               <div class="p-3 bg-light rounded-3">
                 <small class="text-muted d-block">Cuota Mensual</small>
                 <span class="fs-4 fw-bold text-primary">{{ d.monthlyPayment | currency }}</span>
                 
                 <hr class="my-2">
                 
                 <small class="text-muted d-block">Saldo Pendiente</small>
                 <span class="fs-4 fw-bold text-danger">{{ d.remainingAmount | currency }}</span>
               </div>
            </div>

            <div class="col-md-7 d-flex flex-column justify-content-center">
              
              <div class="d-flex justify-content-between small mb-2">
                <span class="fw-bold text-success">Pagado: {{ d.paidInstallments }} cuotas</span>
                <span class="text-muted">Total: {{ d.installments }}</span>
              </div>

              <input type="range" class="form-range" 
                     [min]="0" [max]="d.installments" 
                     [(ngModel)]="d.paidInstallments"
                     (input)="onSliderChange(d, d.paidInstallments)"
                     (change)="saveSliderChange(d)">
              
              <div class="progress mt-2" style="height: 10px;">
                <div class="progress-bar bg-success" role="progressbar" 
                     [style.width.%]="d.progress">
                </div>
              </div>
              
              <small class="text-center text-muted mt-2 fst-italic">
                Desliza para actualizar tu avance üëÜ
              </small>

            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>