<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4 shadow" style="padding-top: 0.75rem; padding-bottom: 0.75rem;">
  <div class="container">
    <a class="navbar-brand fw-bold text-white fs-4 d-flex align-items-center gap-2" href="#">
      <span>üí∞</span> Finance Manager
    </a>

    <div class="d-flex align-items-center gap-3">
        
        <button (click)="toggleCurrency()" 
          class="btn btn-sm rounded-pill text-white d-flex align-items-center gap-2"
          style="background-color: rgba(255, 255, 255, 0.15); border: none; padding: 6px 16px; transition: all 0.2s ease;"
          onmouseover="this.style.backgroundColor='rgba(255, 255, 255, 0.25)'"
          onmouseout="this.style.backgroundColor='rgba(255, 255, 255, 0.15)'"
          title="Cambiar divisa">
      
          <img [src]="currencyCode === 'USD' ? 'https://flagcdn.com/w40/us.png' : 'https://flagcdn.com/w40/br.png'" 
              alt="flag" 
              style="width: 22px; border-radius: 3px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
          
          <span class="fw-bold small" style="letter-spacing: 0.5px;">
              {{ currencyCode }}
          </span>
          
          <i class="fas fa-chevron-down" style="font-size: 0.7em; opacity: 0.7;"></i>
        </button>

        <div style="width: 1px; height: 24px; background-color: rgba(255,255,255,0.2);"></div>

        <button class="btn btn-sm btn-danger d-flex align-items-center gap-2 rounded-pill px-3" (click)="logout()">
          <span class="small fw-bold">Log Out</span>
          <i class="bi bi-box-arrow-right"></i> 
        </button>
    </div>
  </div>
</nav>

<div class="container">

  <div class="card shadow border-0 text-white mb-4" style="background: linear-gradient(to right, #1a1a2e, #16213e);">
    <div class="card-body p-4">
      <div class="row align-items-center">
        
        <div class="col-md-6 border-end border-secondary border-opacity-25 text-center">
            
            <div class="row mb-4">
                <div class="col-6 border-end border-secondary border-opacity-25">
                    <p class="text-secondary small text-uppercase mb-1">Ingresos</p>
                    <h3 class="fw-bold text-success">
                        {{ (totalIncome * exchangeRate) | currency:currencySymbol }}
                    </h3>
                </div>
                <div class="col-6">
                    <p class="text-secondary small text-uppercase mb-1">Gastos</p>
                    <h3 class="fw-bold text-danger">
                        {{ (totalSpent * exchangeRate) | currency:currencySymbol }}
                    </h3>
                </div>
            </div>

            <div class="alert py-2 mb-4" 
                 [ngClass]="{
                    'alert-success': alertColor === 'green',
                    'alert-warning': alertColor === 'orange',
                    'alert-danger': alertColor === 'red'
                 }" role="alert">
                <small><i class="bi bi-info-circle me-1"></i> {{ alertMessage }}</small>
            </div>

            <div class="card border-0 shadow-sm"
                 [ngClass]="totalIncome >= totalSpent ? 'bg-primary bg-gradient' : 'bg-danger bg-gradient'">
                
                <div class="card-body py-3">
                    <p class="small text-uppercase text-white-50 mb-1 fw-bold">
                        {{ totalIncome >= totalSpent ? 'Disponible / Ahorro' : '‚ö†Ô∏è D√©ficit / Deuda' }}
                    </p>

                    <h2 class="display-6 fw-bold mb-0 text-white">
                        {{ ((totalIncome - totalSpent) * exchangeRate) | currency:currencySymbol }}
                    </h2>

                    <p class="small text-white-50 mt-2 mb-0" *ngIf="totalIncome > 0 && totalSpent <= totalIncome">
                        Est√°s ahorrando el <strong>{{ ((totalIncome - totalSpent) / totalIncome) | percent:'1.0-1' }}</strong>
                    </p>

                    <p class="small text-white mt-2 mb-0 fw-bold" *ngIf="totalIncome > 0 && totalSpent > totalIncome">
                        Te has excedido un {{ ((totalSpent - totalIncome) / totalIncome) | percent:'1.0-1' }}
                    </p>
                </div>
            </div>

        </div>

        <div class="col-md-6 d-flex justify-content-center align-items-center mt-4 mt-md-0">
            <div *ngIf="totalSpent > 0" class="p-3 bg-white rounded-4 shadow-sm" style="width: 100%; max-width: 320px;">
                <div style="height: 200px;">
                    <canvas baseChart [data]="pieChartData" [type]="pieChartType" [options]="pieChartOptions"></canvas>
                </div>
            </div>
            <div *ngIf="totalSpent === 0" class="text-white-50 opacity-50">
                <p class="mb-0">Sin gastos para mostrar üìâ</p>
            </div>
        </div>

      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-4 col-md-5 mb-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-white fw-bold" [class.text-primary]="isEditing">
          {{ isEditing ? '‚úèÔ∏è Editando' : '‚ûï Nuevo Movimiento' }}
        </div>

        <div class="card-body">
          <form (ngSubmit)="addTransaction()">
            <div class="mb-3">
              <label class="form-label">Descripci√≥n</label>
              <input type="text" class="form-control" placeholder="Ej: Pizza..." 
                     [(ngModel)]="newTransaction.description" name="desc" required>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Monto ($)</label>
              <input type="number" class="form-control" placeholder="0.00" 
                     [(ngModel)]="newTransaction.amount" name="amount" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Categor√≠a</label>
              <select class="form-select" [(ngModel)]="newTransaction.category" name="cat">
                <optgroup label="Ingresos ü§ë">
                  <option value="Sueldo">Sueldo</option>
                  <option value="Negocio">Negocio</option>
                  <option value="Ingreso Extra">Ingreso Extra</option>
                </optgroup>
                <optgroup label="Gastos üí∏">
                  <option value="Ahorro">Ahorro</option>
                  <option value="Comida">Comida</option>
                  <option value="Transporte">Transporte</option>
                  <option value="Salud">Salud</option>
                  <option value="Ocio">Ocio</option>
                  <option value="Casa">Casa</option>
                </optgroup>
              </select>
            </div>

            <div class="d-grid gap-2 mt-4">
              <button type="submit" class="btn text-white"
                [ngClass]="isEditing ? 'btn-warning text-dark' : ''"
                [style.background-color]="isEditing ? '' : '#303134'"
                
                [disabled]="!newTransaction.description || newTransaction.amount <= 0">
                {{ isEditing ? 'Actualizar' : 'Agregar' }}
              </button>

              <button type="button" class="btn btn-secondary" 
                      *ngIf="isEditing" (click)="cancelEdit()">
                Cancelar
              </button>
            </div>

          </form>
        </div>
      </div>
    </div>

    <div class="col-lg-8 col-md-7 mb-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-white d-flex justify-content-between align-items-center flex-wrap gap-2">
          <span class="fw-bold">üìú Historial</span>
          
          <div class="d-flex gap-2">
             <select class="form-select form-select-sm" style="width: 130px;" [(ngModel)]="selectedPeriod" (change)="applyFilters()">
              <option value="all">Mes</option>
              <option value="1">1¬™ Pago Fin Mes.</option>
              <option value="2">2¬™ Quincena.</option>
            </select>

            <select class="form-select form-select-sm" style="width: 80px;" [(ngModel)]="selectedMonth" (change)="applyFilters()">
              <option [value]="0">Ene</option>
              <option [value]="1">Feb</option>
              <option [value]="2">Mar</option>
              <option [value]="3">Abr</option>
              <option [value]="4">May</option>
              <option [value]="5">Jun</option>
              <option [value]="6">Jul</option>
              <option [value]="7">Ago</option>
              <option [value]="8">Sep</option>
              <option [value]="9">Oct</option>
              <option [value]="10">Nov</option>
              <option [value]="11">Dic</option>
            </select>
            <select class="form-select form-select-sm" style="width: 80px;" [(ngModel)]="selectedYear" (change)="applyFilters()">
                <option *ngFor="let year of years" [value]="year">{{ year }}</option>
            </select>
          </div>
        </div>

        <div class="card-body p-0 table-responsive"> 
          
          <div *ngIf="filteredTransactions.length === 0" class="text-center py-5 text-muted">
            <p>Sin datos este mes.</p>
          </div>

          <table class="table table-hover mb-0 align-middle" *ngIf="filteredTransactions.length > 0">
            <thead class="table-light">
              <tr>
                <th>Fecha</th>
                <th>Desc.</th>
                <th>Cat.</th>
                <th class="text-end">Monto</th>
                <th class="text-center">Acci√≥n</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let t of filteredTransactions">
                <td class="text-muted small">{{ t.transactionDate | date:'dd/MM' }}</td>
                <td class="fw-bold text-truncate" style="max-width: 150px;">{{ t.description }}</td>
                <td><span class="badge bg-secondary rounded-pill">{{ t.category }}</span></td>
                
                <td class="text-end fw-bold" [style.color]="incomeCategories.includes(t.category) ? '#198754' : '#dc3545'">
                  {{ (t.amount * exchangeRate) | currency:currencySymbol }}
                </td>
                
                <td class="text-center">
                  <button class="btn btn-outline-dark btn-sm me-1" (click)="edit(t)">
                    <i class="bi bi-pencil-fill"></i>
                  </button>
                  <button class="btn btn-outline-danger btn-sm" (click)="deleteTransaction(t.id)">
                    <i class="bi bi-trash-fill"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div> 
</div>